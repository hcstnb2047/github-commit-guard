# GitHub Commit Timer - ブラウザ拡張機能 仕様書

## 概要

**GitHub Commit Timer**（旧名：GitHub Commit Guard）は、GitHubのコミット状況に基づいてWebサイトのアクセスを制御するブラウザ拡張機能です。ユーザーがGitHubに定期的にコミットしていない場合、指定されたサイトへのアクセスを制限し、コーディング習慣の形成を促進します。

## 主要機能

### 1. コミット監視機能
- GitHub APIを使用してユーザーのコミット履歴を監視
- 24時間以内のコミット有無を判定
- 30分以内の最新コミットを特別検出（リアルタイムモード）
- 適応的チェック間隔（10秒〜2分）による効率的な監視

### 2. サイトアクセス制御
- コミットがない場合、指定されたサイトへのアクセスを制限
- タイマー機能により一定時間後にアクセス許可
- スキップ機能によるタイマーの強制終了
- GitHub.comは常にアクセス許可

### 3. ユーザーインターフェース
- **ポップアップ**: 現在の状態表示とリアルタイム更新
- **設定画面**: GitHub認証設定とサイト管理
- **タイマー画面**: アクセス制限時の待機画面

### 4. 設定管理
- GitHub Personal Access Token による認証
- ブロック対象サイトの追加・削除
- タイマー制限時間の調整（分単位）
- リアルタイムモードの切り替え

## ファイル構成

```
github-commit-guard/
├── manifest.json          # 拡張機能の設定ファイル
├── background.js          # バックグラウンド処理
├── popup.html            # ポップアップUI
├── popup.js              # ポップアップロジック
├── options.html          # 設定画面UI
├── options.js            # 設定画面ロジック
├── timer.html            # タイマー画面
├── rules.json            # デフォルトのブロックルール
├── icons/                # アイコンファイル
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── requirements.md       # 要件定義
```

## 技術仕様

### 拡張機能基本情報
- **マニフェストバージョン**: 3
- **名称**: GitHub Commit Timer
- **バージョン**: 1.0.0
- **権限**: webRequest, storage, tabs, declarativeNetRequest
- **ホスト権限**: GitHub API、全URLアクセス

### GitHub API仕様
- **使用エンドポイント**:
  - `/users/{username}/events` - ユーザーのイベント履歴取得
  - `/user` - 認証確認とユーザー情報取得
  - `/user/repos` - リポジトリアクティビティ監視
- **レート制限**: 5000リクエスト/時間（認証済み）
- **レート制限管理**: 残り時間とAPI使用量の追跡

### チェック間隔アルゴリズム
```javascript
// 制限中: 頻繁にチェック（新しいコミット検出のため）
if (!hasRecentCommit) {
  if (apiCallsPerHour > 120) return 10秒;  // リアルタイム
  if (apiCallsPerHour > 60) return 30秒;   // 頻繁
  return 2分;                              // 標準
}
// 正常状態: 標準間隔
return 2分;
```

### データストレージ
- **Chrome Storage Local API**使用
- 保存データ:
  - `enabled`: 拡張機能有効/無効
  - `username`: GitHubユーザー名
  - `token`: Personal Access Token
  - `allowedSites`: 許可サイトリスト
  - `timeLimit`: タイマー制限時間（分）
  - `realtimeMode`: リアルタイムモード設定
  - `lastCheck`: 最終チェック時刻
  - `commitStatus`: コミット状況
  - `apiCallsThisHour`: API使用回数

## UIコンポーネント詳細

### ポップアップ (popup.html/js)
- **サイズ**: 350px幅
- **テーマ**: GitHub風ダークテーマ
- **機能**:
  - コミット状況の視覚表示（成功/警告/エラー）
  - 最後のコミット時間表示
  - API使用状況表示
  - リアルタイム更新（5秒間隔）
  - 手動更新ボタン
  - 設定画面へのリンク

### 設定画面 (options.html/js)
- **レイアウト**: カード形式
- **設定項目**:
  - 拡張機能有効/無効トグル
  - GitHubユーザー名・トークン入力
  - 接続テスト機能
  - ブロック対象サイト管理
  - タイマー制限時間設定（スライダー）
  - リアルタイムモード切り替え

### タイマー画面 (timer.html)
- **フルスクリーン表示**
- **要素**:
  - 円形プログレスバー
  - 残り時間表示
  - モチベーションメッセージ（ランダム表示）
  - GitHubへのリンク
  - スキップボタン
  - 統計情報表示

## バックグラウンド処理 (background.js)

### 主要機能
1. **定期的なコミットチェック**
   - 適応的間隔での監視
   - API制限を考慮した最適化
   
2. **アクセス制御ルール管理**
   - Dynamic rules APIによるサイトブロック
   - リダイレクト処理
   
3. **状態管理**
   - バッジアイコン更新
   - 通知機能（オプション）
   - ストレージ変更監視

### イベント処理
- `chrome.runtime.onInstalled`: 初期設定
- `chrome.runtime.onStartup`: 起動時チェック
- `chrome.runtime.onMessage`: 手動チェック要求
- `chrome.storage.onChanged`: 設定変更監視

## セキュリティ仕様

### 認証情報保護
- Personal Access Token の暗号化保存
- 最小権限の原則（repo権限不要）
- トークンの検証機能

### ネットワークセキュリティ
- HTTPS強制
- APIレート制限遵守
- エラーハンドリング

## データフロー

```
1. ユーザー設定入力 → Chrome Storage
2. Background Script → GitHub API チェック
3. コミット状況判定 → Dynamic Rules更新
4. サイトアクセス → ルール適用
5. 制限時 → Timer画面表示
6. タイマー完了 → 元サイトリダイレクト
```

## エラーハンドリング

### API エラー
- 認証失敗: エラー表示とトークン再入力促進
- レート制限: チェック間隔の自動調整
- ネットワークエラー: フォールバック動作（制限解除）

### ユーザーエラー
- 不正なドメイン入力: バリデーションと警告
- 設定の不整合: デフォルト値への復帰

## パフォーマンス最適化

### API使用量最適化
- レート制限の監視と制御
- 必要最小限のAPI呼び出し
- キャッシュ機能による重複チェック回避

### UI応答性
- 非同期処理によるブロッキング回避
- プログレッシブローディング
- リアルタイム更新の効率化

## 今後の拡張可能性

### 予定機能
- 複数GitHubアカウント対応
- コミット品質評価
- 詳細統計機能
- カスタムモチベーションメッセージ
- チーム機能

### 技術的改善
- Service Worker最適化
- PWA対応
- クロスブラウザ対応

## 運用・保守

### 更新方針
- Chrome Web Store経由での自動更新
- 設定データの後方互換性維持
- エラーログの匿名収集（ユーザー同意）

### サポート
- GitHub Issues での問題報告
- ドキュメンテーションの継続更新
- コミュニティフィードバックの反映